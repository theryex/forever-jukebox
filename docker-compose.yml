services:
  forever-jukebox:
    platform: linux/amd64
    container_name: forever-jukebox
    image: forever-jukebox:${GPU_MODE:-cpu}
    build:
      context: .
      args:
        GPU_MODE: ${GPU_MODE:-cpu}
    ports:
      - "8000:8000"
    volumes:
      - storage:/app/api/storage
    environment:
      SPOTIFY_CLIENT_ID: "${SPOTIFY_CLIENT_ID:-}"
      SPOTIFY_CLIENT_SECRET: "${SPOTIFY_CLIENT_SECRET:-}"
      YOUTUBE_API_KEY: "${YOUTUBE_API_KEY:-}"
      FOREVER_JUKEBOX_GPU: "${GPU_MODE:-cpu}"
      ADMIN_KEY: "${ADMIN_KEY:-}"
      WORKER_COUNT: "${WORKER_COUNT:-}"
      ALLOW_USER_UPLOAD: "${ALLOW_USER_UPLOAD:-}"
      ALLOW_USER_YOUTUBE: "${ALLOW_USER_YOUTUBE:-}"
      ALLOW_FAVORITES_SYNC: "${ALLOW_FAVORITES_SYNC:-}"
    restart: unless-stopped
    # For NVIDIA GPU, uncomment below:
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - driver: nvidia
    #           count: 1
    #           capabilities: [gpu]
    # For AMD GPU, uncomment below:
    # devices:
    #   - /dev/kfd:/dev/kfd
    #   - /dev/dri:/dev/dri
    # group_add:
    #   - video
    #   - render

volumes:
  storage:
